!function(e,t){"function"==typeof define&&define.amd?define(["jquery","hgrid"],t):"object"==typeof module?module.exports=t(jQuery,HGrid):t(jQuery,HGrid)}(this,function(e,t){return this.Draggable=function(e,t){"use strict";function o(t){var o=this;o.options=e.extend({},r,t),o.rowMoveManager=null,o._folderTarget=null}var n={cancelEditOnDrag:!0},r={onMoved:function(){},onDrag:function(){},rowMoveManagerOptions:{}};return o.prototype.init=function(o){var r=this,i=o.getData(),s=o.getDataView(),a=o.grid;a.setSelectionModel(new t.RowSelectionModel);var c=e.extend({},n,r.options.rowMoveManagerOptions);r.rowMoveManager=new t.RowMoveManager(c);var l=function(e,t){for(var o=0;o<t.rows.length;o++)if(t.rows[o]===t.insertBefore||t.rows[o]===t.insertBefore-1)return e.stopPropagation(),!1},g=function(e,t){var o=[],n=t.rows,c=n.map(function(e){return s.getItemByIdx(e)}),l=t.insertBefore,g=i.slice(0,l),u=i.slice(l,i.length);n.sort(function(e,t){return e-t});var f;for(f=0;f<n.length;f++)o.push(i[n[f]]);for(n.reverse(),f=0;f<n.length;f++){var d=n[f];l>d?g.splice(d,1):u.splice(d-l,1)}var v=g.concat(o.concat(u)),w=[];for(f=0;f<n.length;f++)w.push(g.length+f);a.resetActiveCell(),s.setItems(v),a.setSelectedRows(w),a.render(),r.options.onMoved.call(r,e,c)},u=function(t,n){var r=a.getCellFromEvent(t);if(r&&(n.row=r.row,i[n.row]&&!Slick.GlobalEditorLock.isActive())){t.stopImmediatePropagation();var s=o.getSelectedRows();s.length&&-1!==e.inArray(n.row,s)||(s=[n.row],o.setSelectedRows(s)),n.rows=s,n.count=s.length}},f=function(e,t){var n=o.getItemFromEvent(e);r._folderTarget=n.kind===FOLDER?n:o.getByID(n.parentID),o.addHighlight(r._folderTarget),r.options.onDrag.call(r,e,t.rows)};r.rowMoveManager.onBeforeMoveRows.subscribe(l),r.rowMoveManager.onMoveRows.subscribe(g),r.rowMoveManager.onDragRows.subscribe(f),a.registerPlugin(r.rowMoveManager),a.onDragInit.subscribe(function(e){e.stopImmediatePropagation}),a.onDragStart.subscribe(u)},o.prototype.destroy=function(){this.rowMoveManager.destroy(),t.Col.Name.behavior=null},t.Draggable=o,o}.call(this,jQuery,t),function(e,t){function o(t){function o(o){t=e.extend(!0,{},d,t),c=o,l=c.getCanvasNode(),f.subscribe(c.onDragInit,r).subscribe(c.onDragStart,i).subscribe(c.onDrag,s).subscribe(c.onDragEnd,a)}function n(){f.unsubscribeAll()}function r(e){e.stopImmediatePropagation()}function i(o,n){var r=c.getCellFromEvent(o);if(t.cancelEditOnDrag&&c.getEditorLock().isActive()&&c.getEditorLock().cancelCurrentEdit(),c.getEditorLock().isActive()||!/move|selectAndMove/.test(c.getColumns()[r.cell].behavior))return!1;g=!0,o.stopImmediatePropagation();var i=c.getSelectedRows();(0==i.length||-1==e.inArray(r.row,i))&&(i=[r.row],c.setSelectedRows(i));var s=c.getOptions().rowHeight;n.selectedRows=i,n.selectionProxy=e("<div class='slick-reorder-proxy'/>").css("position","absolute").css("zIndex","99999").css("width",e(l).innerWidth()).css("height",s*i.length).appendTo(l),n.guide=e("<div class='slick-reorder-guide'/>").css("position","absolute").css("zIndex","99998").css("width",e(l).innerWidth()).css("top",-1e3).appendTo(l),n.insertBefore=-1}function s(t,o){if(g){t.stopImmediatePropagation();var n=t.pageY-e(l).offset().top;o.selectionProxy.css("top",n-5);var r=Math.max(0,Math.min(Math.round(n/c.getOptions().rowHeight),c.getDataLength()));if(r!==o.insertBefore){var i={rows:o.selectedRows,insertBefore:r};u.onBeforeMoveRows.notify(i)===!1?(o.guide.css("top",-1e3),o.canMove=!1):(o.guide.css("top",r*c.getOptions().rowHeight),o.canMove=!0),o.insertBefore=r}u.onDragRows.notify({rows:o.selectedRows,insertBefore:o.insertV})}}function a(e,t){if(g&&(g=!1,e.stopImmediatePropagation(),t.guide.remove(),t.selectionProxy.remove(),t.canMove)){var o={rows:t.selectedRows,insertBefore:t.insertBefore};u.onMoveRows.notify(o)}}var c,l,g,u=this,f=new Slick.EventHandler,d={cancelEditOnDrag:!1};e.extend(this,{onBeforeMoveRows:new Slick.Event,onMoveRows:new Slick.Event,onDragRows:new Slick.Event,init:o,destroy:n})}t.RowMoveManager=o}(jQuery,t),function(e,t){function o(t){function o(o){m=e.extend(!0,{},R,t),h=o,b.subscribe(h.onActiveCellChanged,r(d)),b.subscribe(h.onKeyDown,r(v)),b.subscribe(h.onClick,r(w))}function n(){b.unsubscribeAll()}function r(e){return function(){p||(p=!0,e.apply(this,arguments),p=!1)}}function i(e){for(var t=[],o=0;o<e.length;o++)for(var n=e[o].fromRow;n<=e[o].toRow;n++)t.push(n);return t}function s(e){for(var t=[],o=h.getColumns().length-1,n=0;n<e.length;n++)t.push(new Slick.Range(e[n],0,e[n],o));return t}function a(e,t){var o,n=[];for(o=e;t>=o;o++)n.push(o);for(o=t;e>o;o++)n.push(o);return n}function c(){return i(y)}function l(e){var t,o=[],n=e[e.length-1],r=h.getData(),i=r.getItem(n);if("undefined"!=typeof i){var s=i.parentID;for(t=0;t<e.length;t++){var a=r.getItem(e[t]);a.parentID==s&&o.push(e[t])}}return o}function g(e){u(s(l(e)))}function u(e){y=e,M.onSelectedRangesChanged.notify(y)}function f(){return y}function d(e,t){m.selectActiveRow&&null!=t.row&&u([new Slick.Range(t.row,0,t.row,h.getColumns().length-1)])}function v(e){var t=h.getActiveCell();if(t&&e.shiftKey&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&(38==e.which||40==e.which)){var o=c();o.sort(function(e,t){return e-t}),o.length||(o=[t.row]);var n,r=o[0],i=o[o.length-1];n=40==e.which?t.row<i||r==i?++i:++r:t.row<i?--i:--r,n>=0&&n<h.getDataLength()&&(h.scrollRowIntoView(n),y=s(a(r,i)),u(y)),e.preventDefault(),e.stopPropagation()}}function w(t){var o=h.getCellFromEvent(t);if(!o||!h.canCellBeActive(o.row,o.cell))return!1;if(!h.getOptions().multiSelect||!t.ctrlKey&&!t.shiftKey&&!t.metaKey)return!1;var n=i(y),r=e.inArray(o.row,n);if(-1===r&&(t.ctrlKey||t.metaKey))n.push(o.row),h.setActiveCell(o.row,o.cell);else if(-1!==r&&(t.ctrlKey||t.metaKey))n=e.grep(n,function(e){return e!==o.row}),h.setActiveCell(o.row,o.cell);else if(n.length&&t.shiftKey){var a=n.pop(),c=Math.min(o.row,a),g=Math.max(o.row,a);n=[];for(var f=c;g>=f;f++)f!==a&&n.push(f);n.push(a),h.setActiveCell(o.row,o.cell)}return y=s(l(n)),u(y),t.stopImmediatePropagation(),!0}var h,p,m,y=[],M=this,b=new Slick.EventHandler,R={selectActiveRow:!0};e.extend(this,{getSelectedRows:c,setSelectedRows:g,getSelectedRanges:f,setSelectedRanges:u,init:o,destroy:n,onSelectedRangesChanged:new Slick.Event})}t.RowSelectionModel=o}(jQuery,t),Draggable});