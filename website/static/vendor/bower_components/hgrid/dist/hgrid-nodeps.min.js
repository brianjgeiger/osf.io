/*
 *  HGrid - v0.1.2
 *  A Javascript-based hierarchical grid that can be used to manage and organize files and folders
 */
this.HGrid=function(a){"use strict";function b(){}function c(){return u++}function d(a){void 0===a?(this.data={},this.id=r,this.depth=0,this.dataView=new Slick.Data.DataView({inlineFilters:!0})):(this.data=a,this.id=a.id?a.id:c(),this.depth=null,this.dataView=null),this.children=[],this.parentID=null}function e(a,b,c){for(var d=a.length;d--;)if(a[d]&&a[d].hasOwnProperty(b)&&arguments.length>2&&a[d][b]===c)return a.splice(d,1),!0;return!1}function f(a,b){var c=b.getItemById(a.parentID);return c?b.getIdxById(c.id)+1:0}function g(a){this.data=a,this.id=a.id?a.id:c(),this.parentID=null,this.depth=null,this.children=[],this.dataView=null}function h(){this.queue=[],this.offset=0}function i(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function j(a){return'<span class="hg-indent" style="width:'+a+'px"></span>'}function k(a,b,c){c=c||q;var d=a.depth*c,e=j(d);return e+b}function l(a,b){var c=a.kind===t?o.Html.folderNameClass:o.Html.itemNameClass,d='<span class="'+o.Html.nameClass+" "+c+'" data-id="'+a.id+'">',e="</span>";return[d,b,e].join("")}function m(a){var b,c=a.tag||"button";b=a.cssClass?o.Html.buttonClass+" "+a.cssClass:o.Html.buttonClass;var d=a.action||"noop",e={action:d,cssClass:b,tag:c,text:a.text},f=w('<{{tag}} data-hg-action="{{action}}" class="{{cssClass}}">{{text}}</{{tag}}>',e);return f}function n(a){var b=a.map(function(a){var b=m(a);return b}).join("");return b}function o(b,c){var d=this;if(d.selector=b,d.element=a(b),d.options=a.extend({},x,c),d.grid=null,d.dropzone=null,d.plugins=[],d.options.searchInput){var e=a(d.options.searchInput);if(!e.length)throw new o.Error("Invalid selector for searchInput.");d.searchInput=e}else d.searchInput=null;"string"==typeof d.options.data?d.getFromServer(d.options.data,function(a){d._initData(a),d.init()}):(d._initData(d.options.data),d.init())}function p(a,b){var c;return b.grid&&b.grid._searchText?(a.depth=0,c=b.searchFilter.call(b.grid,a,b.grid._searchText)):(a.depth=a._node.depth,c=!a._hidden),c}var q=20,r="root",s="item",t="folder",u=0;d.fromObject=function(a,b,c){c=c||{};var e,f,h,i;Array.isArray(a)?(e=new d,f=a):(f=a.children||[],e=new d(a),e.depth=b.depth+1,e.dataView=b.dataView,c.collapse&&(e.data._collapsed=!0));for(var j=0,k=f.length;k>j;j++){var l=f[j];l.kind===s?(h=g.fromObject(l,e,c),e.add(h)):(i=d.fromObject(l,e,c),e.add(i))}return e},d.resetIDCounter=function(){u=0},d._getCurrentID=function(){return u},d.prototype.add=function(a,b){return a.parentID=this.id,a.depth=this.depth+1,a.dataView=this.dataView,this.children.push(a),b&&this.insertIntoDataView(a),this},d.prototype.empty=function(a){if(a){var b=this.getItem();this.dataView.deleteItem(b.id)}for(var c,d=0;c=this.children[d];d++)c.empty(!0),c.children=[];return this.children=[],this},d.prototype.remove=function(a){var b="object"==typeof a?a.id:a,c=e(this.children,"id",a);if(c)this.dataView.deleteItem(b);else for(var d,f=0;d=this.children[f];f++)c=d.remove(a)},d.prototype.getItem=function(){return this.dataView.getItemById(this.id)},d.prototype.sort=function(a,b){this.children.sort(function(c,d){var e=c.data[a],f=d.data[a],g=b?1:-1,h=(e===f?0:e>f?1:-1)*g;return 0!==h?h:0});for(var c,d=0;c=this.children[d];d++)c.sort(a,b);return this},d.prototype.sortCmp=function(a){this.children.sort(a);for(var b,c=0;b=this.children[c];c++)b.sortCmp(key);return this},d.prototype.insertIntoDataView=function(a){var b,c=a.toData();if(Array.isArray(c))for(var d=0,e=c.length;e>d;d++){var g=c[d];b=f(g,this.dataView),this.dataView.insertItem(b,g)}else b=f(c,this.dataView),this.dataView.insertItem(b,c);return this},d.prototype.ensureDataView=function(a){a||(a=this.dataView),this.dataView=a;for(var b,c=0;b=this.children[c];c++)b.ensureDataView(a);return this},d.prototype.updateDataView=function(a){if(!this.dataView)throw new o.Error("Tree does not have a DataView. updateDataView must be called on a root node.");return a||this.ensureDataView(),this.dataView.beginUpdate(),this.dataView.setItems(this.toData()),this.dataView.endUpdate(),this},d.prototype.toData=function(b){var c=b||[];if(0!==this.depth){var d=a.extend({},{id:this.id,parentID:this.parentID,_node:this,depth:this.depth},this.data);c.push(d)}for(var e=0,f=this.children.length;f>e;e++){var g=this.children[e];g.toData(c)}return c},d.prototype.collapse=function(a,b){var c;this.isRoot()||(c=this.getItem(),a?c._hidden=!0:(c._collapsed=!0,c._hidden=!1));for(var d,e=0;d=this.children[e];e++)d.collapse(!0);return!this.isRoot()&&b&&this.dataView.updateItem(c.id,c),this},d.prototype.bfTraverse=function(a,b){for(var c=new h,d=this;d&&!(b&&d.depth>b);){if(a.call(this,d),d.children.length)for(var e,f=0;e=d.children[f];f++)c.enq(e);d=c.deq()}return this},d.prototype.collapseAt=function(a,b){return 0===a?this.collapse(!1,b):(this.bfTraverse(function(b){b.depth===a&&b instanceof d&&b.collapse(!1,!0)},a),b&&this.dataView.refresh(),this)},d.prototype.expandAt=function(a,b){return 0===a?this.expand(!1,b):(this.bfTraverse(function(b){!b.isRoot()&&b.depth<a&&b.expand(!1,!0)},a),b&&this.dataView.refresh(),this)},d.prototype.isHidden=function(){return this.getItem()._hidden},d.prototype.expand=function(a,b){var c;this.isRoot()||(c=this.getItem(),a||(c._collapsed=!1),c._hidden=!1);for(var d,e=0;d=this.children[e];e++)c._collapsed||d.expand(!0);return!this.isRoot()&&b&&this.dataView.updateItem(c.id,c),this},d.prototype.isRoot=function(){return 0===this.depth},d.prototype.isCollapsed=function(){return Boolean(this.getItem()._collapsed)},g.fromObject=function(a,b,c){c=c||{};var d=new g(a);return b&&(d.depth=b.depth+1,d.parentID=b.id,d.dataView=b.dataView),c.collapse&&(d.data._collapsed=!0),d},g.prototype.getItem=function(){return this.dataView.getItemById(this.id)},g.prototype.collapse=function(){var a=this.getItem();return a._collapsed=a._hidden=!0,this},g.prototype.expand=function(){var a=this.getItem();return a._collapsed=a._hidden=!1,this},g.prototype.remove=b,g.prototype.toData=function(b){var c=a.extend({},{id:this.id,parentID:this.parentID,_node:this,depth:this.depth},this.data);return b&&b.push(c),c},g.prototype.ensureDataView=function(a){return a||(a=this.dataView),this.dataView=a,this},g.prototype.sort=b,g.prototype.isRoot=function(){return 0===this.depth},g.prototype.empty=function(){var a=this.getItem();return this.dataView.deleteItem(a.id),this},h.prototype.enq=function(a){this.queue.push(a)},h.prototype.deq=function(){if(0===this.queue.length)return void 0;var a=this.queue[this.offset];return 2*++this.offset>=this.queue.length&&(this.queue=this.queue.slice(this.offset),this.offset=0),a},h.prototype.isEmpty=function(){return 0===this.queue.length};var v={},w=function(a,b){return a?(v[a]=v[a]||new Function("_","return '"+a.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/'/g,"\\'").replace(/\{\{\s*(\w+)\s*\}\}/g,"'+(_.$1?(_.$1+''):(_.$1===0?0:''))+'")+"'"),v[a](b)):""};o.Html={expandElem:'<span class="hg-toggle hg-expand"></span>',collapseElem:'<span class="hg-toggle hg-collapse"></span>',folderIcon:'<i class="hg-folder"></i>',fileIcon:'<i class="hg-file"></i>',errorElem:'&nbsp;<span class="error" data-upload-errormessage></span>',buttonClass:"hg-btn",nameClass:"hg-name",folderNameClass:"hg-folder-name",itemNameClass:"hg-item-name",toggleClass:"hg-toggle"},o.Fmt=o.Format={withIndent:k,asName:l,makeIndentElem:j,sanitized:i,button:m,buttons:n,tpl:w},o.Actions={download:{on:"click",callback:function(a,b){this.options.onClickDownload.call(this,a,b)}},"delete":{on:"click",callback:function(a,b){this.options.onClickDelete.call(this,a,b)}},upload:{on:"click",callback:function(a,b){this.options.onClickUpload.call(this,a,b)}},noop:{on:"click",callback:b}},o.Col=o.Columns={Name:{id:"name",name:"Name",sortkey:"name",folderView:o.Html.folderIcon+" {{name}}",itemView:o.Html.fileIcon+" {{name}}",sortable:!0,indent:q,isName:!0,showExpander:function(a,b){return a.kind===o.FOLDER&&(a._node.children.length&&a.depth||b.lazyLoad)&&!a._processing}},ActionButtons:{id:"actions",name:"Actions",width:50,sortable:!1,folderView:function(){var a=[];return this.options.uploads&&a.push({text:"Upload",action:"upload"}),a?n(a):""},itemView:function(){var a=[{text:"Download",action:"download"},{text:"Delete",action:"delete"}];return n(a)}}};var x={data:null,ajaxOptions:{},fetchUrl:null,fetchSuccess:function(){},fetchError:function(){},fetchStart:function(){},uploads:!1,columns:[o.Columns.Name],width:600,height:300,highlightClass:"hg-row-highlight",indent:q,slickgridOptions:{},uploadUrl:null,acceptedFiles:null,maxFilesize:256,uploadMethod:"POST",uploadHeaders:{},dropzoneOptions:{},onClick:function(){},onClickDownload:function(a,b,c){this.downloadItem(b,c)},onClickDelete:function(a,b,c){this.deleteFile(b,c)},onClickUpload:function(a,b){this.uploadToFolder(b)},onExpand:function(){},onCollapse:function(){},onItemAdded:function(){},onDragover:function(){},onDragenter:function(){},onDragleave:function(){},onDrop:function(){},onSort:function(){},uploadAdded:function(){},uploadProcessing:function(){},uploadError:function(b,c){var d,e=a(b.gridElement);return d="string"!=typeof c&&c.error?c.error:c,e.find("[data-upload-errormessage]").each(function(){this.textContent=d}),this},uploadProgress:function(b,c){var d=a(b.gridElement);d.width(c+"%")},uploadSuccess:function(){},uploadComplete:function(){},uploadAccept:function(a,b,c){return c()},uploadSending:function(){},downloadUrl:function(){},deleteUrl:function(){},deleteMethod:function(){},listeners:[],init:function(){},searchInput:null,searchFilter:function(a,b){return-1!==a.name.toLowerCase().indexOf(b)},canUpload:function(){return!0},uploadDenied:function(){}};o._defaults=x,o.Tree=d,o.Leaf=g,o.Queue=h,o.DEFAULT_INDENT=q,o.ROOT_ID=r,o.FOLDER=t,o.ITEM=s,o.Error=function(a){this.name="HGrid.Error",this.message=a||""},o.Error.prototype=new Error,o.prototype.collapseAll=function(){return this.tree.collapseAt(1,!0),this},o.prototype.emptyFolder=function(a,b){return a="object"==typeof a?a:this.getByID(a),a._node.empty(b),b||this.getDataView().updateItem(a.id,a),this},o.prototype.getFromServer=function(b,c){var d=this,e=a.extend({},{url:b,contentType:"application/json",dataType:"json",success:function(a){c&&c.call(d,a)},error:function(a,b,e){c&&c.call(d,null,e,b)}},d.options.ajaxOptions);return a.ajax(e)},o.prototype._initData=function(a){var b=this;return a?(b.tree=d.fromObject(Array.isArray(a)?a:a.data),b.tree.updateDataView()):b.tree=new d,b},o.prototype.init=function(){if(this.setHeight(this.options.height).setWidth(this.options.width)._initSlickGrid()._initDataView(),this.options.uploads){if("undefined"==typeof Dropzone)throw new o.Error("uploads=true requires DropZone to be loaded");this._initDropzone()}return this._initListeners(),this.isLazy()&&this.collapseAll(),this.options.init.call(this),this},o.prototype.setHeight=function(a){return"auto"===a?this.options.slickgridOptions.autoHeight=!0:this.element.css("height",a),this},o.prototype.setWidth=function(a){return this.element.css("width",a),this},o.prototype.makeFormatter=function(a){var b,c,d=this,e=a.folderView,f=a.itemView,g=a.showExpander,h="number"==typeof a.indent?a.indent:q,i=function(i,j,m,n,p){var q={colDef:n,row:i,cell:j,indent:a.indent,lazyLoad:d.isLazy()};if(b=p.kind===t?e:f,c="function"==typeof b?b.call(d,p,q):o.Format.tpl(b,p),a.isName&&(c=l(p,c)),g){var r;r="function"==typeof g&&g(p,q)?p._collapsed?o.Html.expandElem:o.Html.collapseElem:'<span style="width:16px;height:1px;display:inline-block;"></span>',c=[r,c].join("")}return a.indent&&(c=k(p,c,h)),c};return i},o.prototype._makeSlickgridColumns=function(a){var b=this,c=a.map(function(a){return"formatter"in a||(a.formatter=b.makeFormatter.call(b,a)),"text"in a&&(a.name=a.text),a.cssClass="cssClass"in a?a.cssClass+" hg-cell":"hg-cell",a});return c};var y={editable:!1,asyncEditorLoading:!1,enableCellNavigation:!1,enableColumnReorder:!1,forceFitColumns:!0,fullWidthRows:!0};o.prototype._initSlickGrid=function(){var b=this,c=b._makeSlickgridColumns(b.options.columns),d=a.extend({},y,b.options.slickgridOptions);return b.grid=new Slick.Grid(b.element.selector,b.tree.dataView,c,d),b},o.prototype.removeHighlight=function(a){var b=a||this.options.highlightClass;return this.element.find("."+b).removeClass(b),this},o.prototype.getRowElement=function(a){"object"==typeof a&&(a=a.id);try{return this.grid.getCellNode(this.getDataView().getRowById(a),0).parentNode}catch(b){throw new o.Error("Row element is not rendered in the DOM.")}},o.prototype.addHighlight=function(b,c){var d=c||this.options.highlightClass;this.removeHighlight();var e;return e=a(b&&b.kind===t?this.getRowElement(b.id):this.getRowElement(b.parentID)),e&&e.addClass(d),this},o.prototype.slickEvents={onClick:function(a,b){var c=this.getDataView().getItem(b.row);return this.canToggle(a.target)&&this.toggleCollapse(c,a),this.options.onClick.call(this,a,c),this},onCellChange:function(a,b){return this.getDataView().updateItem(b.item.id,b.item),this},onMouseLeave:function(){this.removeHighlight()},onSort:function(a,b){var c=b.sortCol,d=c.field||c.sortkey;if(!d)throw new o.Error("Sortable column does not define a `sortkey` to sort on.");this.tree.sort(d,b.sortAsc),this.tree.updateDataView(!0),this.options.onSort.call(this,a,c,b)}},o.prototype.getItemFromEvent=function(a){var b=this.grid.getCellFromEvent(a);return b?this.getDataView().getItem(b.row):null},o.prototype.uploadToFolder=function(a){this.currentTarget=a,this.setUploadTarget(a),this.dropzone.hiddenFileInput.click()},o.prototype.downloadItem=function(a){var b;return b="function"==typeof this.options.downloadUrl?this.options.downloadUrl(a):this.options.downloadUrl,b&&(window.location=b),this},o.prototype.deleteFile=function(b,c){var d,e,f=this;d="function"==typeof this.options.deleteUrl?this.options.deleteUrl(b):this.options.deleteUrl,e="function"==typeof this.options.deleteMethod?this.options.deleteMethod(b):this.options.deleteMethod;var g=a.extend({},{url:d,type:e,success:function(){f.updateItem(f.getByID(b.parentID)),f.removeItem(b.id)}},f.options.ajaxOptions,c),h=null;return d&&(h=a.ajax(g)),h},o.prototype.currentTarget=null,o.prototype.setUploadTarget=function(b){function c(a){return"function"==typeof a?a.call(d,b):a}var d=this;d.currentTarget&&a.when(c(d.options.uploadHeaders),c(d.options.uploadUrl),c(d.options.uploadMethod),c(d.options.maxFilesize),c(d.options.acceptedFiles)).done(function(a,c,e,f,g){d.dropzone.options.headers=a,d.dropzone.options.url=c,d.dropzone.options.method=e,d.dropzone.options.maxFilesize=f,d.setAcceptedFiles(g),d.options.uploadAccept&&(d.dropzone.options.accept=function(a,c){return d.options.uploadAccept.call(d,a,b,c)})})},o.prototype.canUpload=function(a){return Boolean(a&&this.options.canUpload(a))},o.prototype.denyUpload=function(a){throw this.options.uploadDenied.call(this,a),new o.Error("Upload permission denied.")},o.prototype.validateTarget=function(a){return this.canUpload(a)?a:this.denyUpload(a)},o.prototype.dropzoneEvents={drop:function(a){this.removeHighlight(),this.validateTarget(this.currentTarget),this.setUploadTarget(this.currentTarget),this.options.onDrop.call(this,a,this.currentTarget)},dragleave:function(a){this.removeHighlight();var b=this.getItemFromEvent(a);this.options.onDragleave.call(this,a,b)},dragenter:function(a){var b=this.getItemFromEvent(a);b&&(this.currentTarget=b.kind===t?b:this.getByID(b.parentID)),this.options.onDragenter.call(this,a,b)},dragover:function(a){var b=this.currentTarget,c=this.getItemFromEvent(a);this.canUpload(b)&&b&&this.addHighlight(b),this.options.onDragover.call(this,a,c)},dragend:function(){this.removeHighlight()},addedfile:function(b){var c=this.currentTarget;this.validateTarget(c);var d;if(this.canUpload(c)){d=this.addItem({name:b.name,kind:o.ITEM,parentID:c.id});var e=this.getRowElement(d.id),f=a(e);b.gridItem=d,b.gridElement=e,f.addClass("hg-upload-started")}return this.options.uploadAdded.call(this,b,b.gridItem,c),d},thumbnail:b,error:function(b,c){var d=a(b.gridElement);d.addClass("hg-upload-error").removeClass("hg-upload-processing");var e=a.extend({},b.gridItem);return this.removeItem(b.gridItem.id),this.options.uploadError.call(this,b,c,e,this.currentTarget)},processing:function(b){return a(b.gridElement).addClass("hg-upload-processing"),this.currentTarget._processing=!0,this.updateItem(this.currentTarget),this.options.uploadProcessing.call(this,b,b.gridItem,this.currentTarget),this},uploadprogress:function(a,b,c){return this.options.uploadProgress.call(this,a,b,c,a.gridItem)},success:function(b,c){return a(b.gridElement).addClass("hg-upload-success"),this.options.uploadSuccess.call(this,b,b.gridItem,c)},complete:function(b){return a(b.gridElement).removeClass("hg-upload-processing"),this.currentTarget._processing=!1,this.updateItem(this.currentTarget),this.options.uploadComplete.call(this,b,b.gridItem)},sending:function(a,b,c){return this.options.uploadSending(a,a.gridItem,b,c)}},o.prototype._initListeners=function(){var a,b,c=this;for(a in c.slickEvents)b=c.slickEvents[a].bind(c),c.grid[a].subscribe(b);if(this.options.uploads)for(a in c.dropzoneEvents)b=c.dropzoneEvents[a].bind(c),c.dropzone.on(a,b);for(var d,e=function(a){var b=c.getItemFromEvent(a);return a.data.listenerObj.callback(a,b,a.data.grid)},f=0;d=this.options.listeners[f];f++)c.element.on(d.on,d.selector,{listenerObj:d,grid:c},e);this.attachActionListeners(),c.searchInput&&c.searchInput.keyup(function(){c._searchText=this.value,c.getDataView().refresh(),c.grid.invalidate(),c.grid.render()})},o.prototype.attachActionListeners=function(){var b=this;a.extend(o.Actions,b.options.actions);var c=function(a){var c=b.getItemFromEvent(a);a.data.actionObj.callback.call(b,a,c)};for(var d in o.Actions){var e=o.Actions[d];this.element.on(e.on,'[data-hg-action="'+d+'"]',{actionObj:e},c)}return this},o._hgFilter=p,o.prototype._initDataView=function(){var a=this,b=this.getDataView();return b.beginUpdate(),b.setFilterArgs({grid:a,searchFilter:a.options.searchFilter}),b.setFilter(p),b.endUpdate(),b.onRowCountChanged.subscribe(function(){a.grid.updateRowCount(),a.grid.render()}),b.onRowsChanged.subscribe(function(b,c){a.grid.invalidateRows(c.rows),a.grid.render()}),this};var z={addRemoveLinks:!1,previewTemplate:"<div></div>"};return o.prototype.setAcceptedFiles=function(a){var b;return b=Array.isArray(a)?a.join(","):a,this.dropzone.options.acceptedFiles=b,this},o.prototype._initDropzone=function(){function b(a,b){return"function"==typeof a||null==a?b:a}var c,d,e,f=null;c=b(this.options.uploadUrl,"/"),d=b(this.options.uploadMethod,"POST"),e=b(this.options.uploadHeaders,{}),f=b(this.options.acceptedFiles,null),Array.isArray(f)&&(f=f.join(","));var g=a.extend({},{url:c,acceptedFiles:f,maxFilesize:this.options.maxFilesize,method:d,headers:e},z,this.options.dropzoneOptions);return this.dropzone=new Dropzone(this.selector,g),this},o.prototype.destroy=function(){this.element.html(""),this.grid.destroy(),this.dropzone&&this.dropzone.destroy()},o.prototype.getData=function(){return this.getDataView().getItems()},o.prototype.getByID=function(a){var b=this.getDataView();return b.getItemById(a)},o.prototype.getDataView=function(){return this.grid.getData()},o.prototype.getRefreshHints=function(a){var b=this.getDataView().getRowById(a.id),c={expand:{isFilterNarrowing:!1,isFilterExpanding:!0,ignoreDiffsBefore:b},collapse:{isFilterNarrowing:!0,isFilterExpanding:!1,ignoreDiffsBefore:b}};return c},o.prototype.isLazy=function(){return Boolean(this.options.fetchUrl)},o.prototype._lazyLoad=function(a){var b=this,c=b.options.fetchUrl(a);return null!==c?(b.options.fetchStart.call(b,a),a._node._loaded=!0,b.getFromServer(c,function(d,e){if(e)throw a._node._loaded=!1,b.options.fetchError.call(b,e,a),new o.Error('Could not fetch data from url: "'+c+'". Error: '+e);b.addData(d,a.id),b.options.fetchSuccess.call(b,d,a)})):!1},o.prototype.expandItem=function(a,b){var c=this;a="object"==typeof a?a:c.getByID(a);var d=c.getNodeByID(a.id);a._node.expand();var e=c.getDataView(),f=c.getRefreshHints(a).expand;return e.setRefreshHints(f),c.getDataView().updateItem(a.id,a),c.isLazy()&&!d._loaded&&this._lazyLoad(a),c.options.onExpand.call(c,b,a),c},o.prototype.collapseItem=function(a,b){a="object"==typeof a?a:this.getByID(a),a._node.collapse();var c=this.getDataView(),d=this.getRefreshHints(a).collapse;return c.setRefreshHints(d),c.updateItem(a.id,a),this.options.onCollapse.call(this,b,a),this},o.prototype.updateItem=function(a){return this.getDataView().updateItem(a.id,a)},o.prototype.isCollapsed=function(a){return Boolean(a._collapsed)},o.prototype.canToggle=function(b){return a(b).hasClass(o.Html.toggleClass)},o.prototype.addItem=function(a){var b,c;b=a.kind===o.FOLDER?new o.Tree(a):new o.Leaf(a),c=null==a.parentID?this.tree:this.getNodeByID(a.parentID),c.add(b,!0);var d=this.getByID(b.id);return this.options.onItemAdded.call(this,d),d},o.prototype.addItems=function(a){var b=this;return this.batchUpdate(function(){for(var c=0,d=a.length;d>c;c++){var e=a[c];b.addItem(e)}}),this},o.prototype.batchUpdate=function(a){this.getDataView().beginUpdate(),a.call(this),this.getDataView().endUpdate()},o.prototype.addColumn=function(a){var b=this.grid.getColumns();return b.push(a),this.grid.setColumns(b),this},o.prototype.removeItem=function(a){return this.tree.remove(a)},o.prototype.getNodeByID=function(a){if(a===o.ROOT_ID||null==a)return this.tree;var b=this.getByID(a);return b._node},o.prototype.toggleCollapse=function(a,b){return a&&(this.isCollapsed(a)?this.expandItem(a,b):this.collapseItem(a,b)),this},o.prototype.addData=function(a,b){var c,e=this,f=this.getNodeByID(b);c=Array.isArray(a)?a:a.data;for(var h,i=0;h=c[i];i++){var j;if(h.kind===o.FOLDER){var k={collapse:e.isLazy()};j=d.fromObject(h,f,k)}else j=g.fromObject(h,f);f.add(j,!0)}return this},o.prototype.resetLoadedState=function(a,b){return a._node._loaded=Boolean(b),this},o.prototype.reloadFolder=function(a){return this.resetLoadedState(a),this.emptyFolder(a),this.collapseItem(a),this.expandItem(a),this},o.prototype.render=function(){return this.grid.render(),this},o.prototype.invalidate=function(){return this.grid.invalidate(),this},o.prototype.registerPlugin=function(a){this.plugins.unshift(a),a.init(this)},o.prototype.unregisterPlugin=function(a){for(var b=this.plugins,c=b.length;c>=0;c--)if(b[c]===a){b[c].destroy&&b[c].destroy(),b.splice(c,1);break}},a.fn.hgrid=function(a){this.each(function(){if(!this.id)throw new o.Error("Element must have an ID if initializing HGrid with jQuery");var b="#"+this.id;return new o(b,a)})},o}.call(this,jQuery);